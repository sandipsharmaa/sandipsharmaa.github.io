!function(e,t){"function"==typeof define&&define.amd?define(["exports"],function(n){t(e,n)}):"undefined"!=typeof exports?t(e,exports):t(e,e.fd=e.fd||{})}(this,function(t,n){n.randomID=function(e){return(e||"fd")+"_"+(1e4*Math.random()).toFixed()},n.uniqueID=function(e){do var t=n.randomID(e);while(n.byID(t));return t},n.byID=function(e){return n.isTag(e)?e:document.getElementById(e)},n.isTag=function(e,t){return"object"==typeof e&&e&&1==e.nodeType&&(!t||e.tagName.toUpperCase()==t.toUpperCase())},n.newXHR=function(){try{return new XMLHttpRequest}catch(e){for(var t=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<t.length;n++)try{return new ActiveXObject(t[n])}catch(e){}}throw"Cannot create XMLHttpRequest."},n.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.toArray=function(e,t){return null===e||"undefined"==typeof e?[]:(n.isArray(e)||"object"==typeof e&&"callee"in e||(e=[e]),Array.prototype.slice.call(e,t||0))},n.addEvent=function(e,t,n){return e&&t&&n&&(e.attachEvent?(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n])):e.addEventListener(t,n,!1)),e},n.stopEvent=function(e){return e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e},n.setClass=function(e,t,i){return(e=n.byID(e))&&null!=t&&("undefined"==typeof i||i?n.hasClass(e,t)||(e.className+=" "+t):e.className=e.className.replace(n.classRegExp(t)," ")),e},n.hasClass=function(e,t){return n.classRegExp(t).test((n.byID(e)||{}).className)},n.classRegExp=function(e){return""==e||"object"==typeof e?/$o_O/:new RegExp("(^|\\s+)"+e+"(\\s+|$)","gi")},n.extend=function(e,t,n){e=e||{},t=t||{};for(var i in t)(n||"undefined"==typeof e[i])&&(e[i]=t[i]);return e},n.callAll=function(e,t,i){var a;if(t=n.toArray(t),"function"==typeof e&&(e=[e]),n.isArray(e))for(var r=0;r<e.length&&("function"!=typeof e[r]||(a=e[r].apply(i||this,t),null==a));r++);else if(e)throw"FileDrop event list must be either an Array, Function, undefined or null but "+typeof e+" was given.";return a},n.callAllOfObject=function(e,t,i){if(n.logging&&n.hasConsole){var a=e.events[t]?e.events[t].length||0:0;console.info("FileDrop "+t+" event ("+a+") args:"),console.dir([i])}var r=[n.onObjectCall].concat(e.events.any),o=n.callAll(r,[t].concat(n.toArray(i)),e);return null!=o?o:n.callAll(e.events[t],i,e)},n.appendEventsToObject=function(e,t){if(n.addEventsToObject(this,!1,arguments))return this;switch(arguments.length){case 0:return n.extend({},this.events);case 1:if(null===e)return this.events={},this;if(n.isArray(e)){for(var i={},a=0;a<e.length;a++)i[e[a]]=n.toArray(this.events[e[a]]);return i}if("function"==typeof e)return n.funcNS(e);if("string"==typeof e)return n.toArray(this.events[e]);case 2:if(e=n.toArray(e),null===t){for(var a=0;a<e.length;a++){var r=n.splitNS(e[a]);if(r[0])if(r[1]){if(this.events[r[0]])for(var o=this.events[r[0]].length-1;o>=0;o--)n.funcNS(this.events[r[0]][o])==r[1]&&this.events[r[0]].splice(o,1)}else this.events[r[0]]=[];else for(var s in this.events)arguments.callee.call(this,[s+":"+r[1]],null)}return this}}throw"Bad parameters for FileDrop event()."},n.previewToObject=function(e,t){if(n.addEventsToObject(this,!0,arguments))return this;throw"Bad parameters for FileDrop preview()."},n.addEventsToObject=function(e,t,i){var a=i[0],r=i[1];switch(i.length){case 1:if(a&&"object"==typeof a&&!n.isArray(a)){for(var o in a)arguments.callee(e,t,[o,a[o]]);return!0}case 2:if("function"==typeof r||n.isArray(r)){a=n.toArray(a),r=n.toArray(r);for(var s=t?"unshift":"push",l=0;l<a.length;l++){for(var u=n.splitNS(a[l]),p=0;p<r.length;p++)n.funcNS(r[p],u[1]);e.events[u[0]]=e.events[u[0]]||[],e.events[u[0]][s].apply(e.events[u[0]],r)}return!0}}},n.funcNS=function(e,t){return"function"!=typeof e?e:1==arguments.length?(e[n.nsProp]||"").toString():(e[n.nsProp]=(t||"").toString(),e)},n.splitNS=function(e){return(e||"").match(/^([^:]*):?(.*)$/).slice(1)},n.extend(n,{logging:!0,hasConsole:"console"in window&&console.log&&console.dir,onObjectCall:null,all:[],isIE6:!1,isIE9:!1,isChrome:-1!=(navigator.vendor||"").indexOf("Google"),nsProp:"_fdns"}),n.DropHandle=function(e,t){var i=this;if(i.el=e=n.byID(e),!e)throw"Cannot locate DOM node given to new FileDrop class.";i.opt={zoneClass:"fd-zone",inputClass:"fd-file",iframe:{url:"",callbackParam:"fd-callback",fileParam:"fd-file"},input:null,recreateInput:!0,fullDocDragDetect:!1,multiple:!1,dropEffect:"copy"},n.all.push(i),i.filedrop=null;var a=i.opt.iframe;n.extend(i.opt,t,!0),n.extend(i.opt.iframe,a),n.isChrome&&(i.opt.fullDocDragDetect=!0),i.events={any:[],dragEnter:[],dragLeave:[],dragOver:[],dragEnd:[],dragExit:[],upload:[],uploadElsewhere:[],inputSetup:[],iframeSetup:[],iframeDone:[]},i.on=i.events,i.zone=i.el,i.hook=function(e){0!=i.opt.input&&(i.opt.input=i.opt.input||i.prepareInput(e),i.opt.input&&n.callAllOfObject(i,"inputSetup",i.opt.input)),i.hookDragOn(e),i.hookDropOn(e)},i.hookDragOn=function(e){i.opt.fullDocDragDetect?(i.delegate(document.body,"dragEnter"),n.addEvent(document,"dragleave",function(e){(0==e.clientX&&0==e.clientY||n.isTag(e.relatedTarget,"html"))&&(n.stopEvent(e),n.callAllOfObject(i,"dragLeave",e))})):(i.delegate(e,"dragEnter"),i.delegate(e,"dragLeave")),i.delegate(e,"dragOver"),i.delegate(e,"dragEnd"),i.delegate(e,"dragExit")},i.hookDropOn=function(e){n.isIE9||i.delegate(e,"drop","upload")},i.delegate=function(e,t,a){n.addEvent(e,t.toLowerCase(),function(e){n.stopEvent(e),n.callAllOfObject(i,a||t,e)})},i.prepareInput=function(e){var t=i.findInputRecursive(e)||i.createInputAt(e);if(t){for(var a=t.parentNode;a&&!n.isTag(a,"form");)a=a.parentNode;if(!a)throw"FileDrop file input has no parent form element.";var r=a?a.getAttribute("target"):"";if(r&&n.isTag(n.byID(r),"iframe"))return{file:t,form:a}}return!1},i.findInputRecursive=function(e){for(var t=0;t<e.childNodes.length;t++){var a=e.childNodes[t];if(n.isTag(a,"input")&&"file"==a.getAttribute("type")&&n.hasClass(a,i.opt.inputClass))return a;if(a=arguments.callee(a))return a}},i.createInputAt=function(e){do var t=n.randomID();while(n.byID(t));var a=document.createElement("div");a.innerHTML='<iframe src="javascript:false" name="'+t+'"></iframe><form method="post" enctype="multipart/form-data"><input type="hidden" name="'+i.opt.iframe.callbackParam+'" /><input type="file" name="'+i.opt.iframe.fileParam+'" /></form>',a.firstChild.setAttribute("id",t),a.firstChild.style.display="none",a.lastChild.setAttribute("target",t);for(var r=e.firstChild;r&&(!n.isTag(r)||n.isTag(r,"legend"));)r=r.nextSibling;return r?e.insertBefore(a,r):e.appendChild(a),a.lastChild.lastChild},i.abortIFrame=function(){if(i.opt.input.form){var e=n.byID(i.opt.input.form.getAttribute("target"));e&&e.setAttribute("src","javascript:false")}},i.sendViaIFrame=function(e){e=e||i.opt.iframe.url;var t=(i.opt.input||{}).form;if(e&&t){do var a=n.randomID();while(a in window);window[a]=function(t){"object"!=typeof t&&(t={response:t,responseXML:"",responseText:(t||"").toString(),readyState:4,status:200,statusText:"OK",getAllResponseHeaders:function(){return""},getResponseHeader:function(){return""},setRequestHeader:function(){return this},statusCode:function(){return this},abort:function(){return this}}),n.extend(t,{iframe:!0,url:e}),n.callAllOfObject(i,"iframeDone",t)};for(var r=t.firstChild;r&&(!n.isTag(r,"input")||r.name!=i.opt.iframe.callbackParam);)r=r.nextSibling;return r?r.value=a:e=e.replace(/[?&]+$/,"")+(-1==e.indexOf("?")?"?":"&")+i.opt.iframe.callbackParam+"="+a,t.setAttribute("action",e),n.callAllOfObject(i,"iframeSetup",t),t.submit(),setTimeout(i.resetForm,300),!0}},i.resetForm=function(){var e=i.opt.input&&i.opt.input.file;if(e&&(e.value="",i.opt.recreateInput)){var t=i.opt.input.file=e.cloneNode(!0);e.parentNode.replaceChild(t,e),n.callAllOfObject(i,"inputSetup",[i.opt.input,e])}},i.multiple=function(e){return i.opt.input&&"undefined"!=typeof e&&(e?i.opt.input.file.setAttribute("multiple","multiple"):i.opt.input.file.removeAttribute("multiple")),i.opt.input&&!!i.opt.input.file.getAttribute("multiple")},i.event=function(e,t){return n.appendEventsToObject.apply(i,arguments)},i.preview=function(e,t){return n.previewToObject.apply(i,arguments)},i.onInputSetup=function(t,a){a?(t.file.clearAttributes&&t.file.clearAttributes(),t.file.mergeAttributes&&t.file.mergeAttributes(a)):i.multiple(i.opt.multiple),n.setClass(t.file,i.opt.inputClass),i.delegate(t.file,"change","upload");var r=t.file.parentNode;if(r&&r.style.display.match(/^(static)?$/)&&(r.style.position="relative"),n.isTag(e,"fieldset")){var o=document.createElement("div");o.style.position="relative",o.style.overflow="hidden",e.parentNode.insertBefore(o,e),o.appendChild(e)}},i.onDragOver=function(e){n.stopEvent(e),e.dataTransfer&&(e.dataTransfer.dropEffect=i.opt.dropEffect)},i.onUpload=function(){for(var e=0;e<n.all.length;e++)n.all[e]!==i&&n.all[e].events&&n.callAllOfObject(n.all[e],"uploadElsewhere",i)},i.event({inputSetup:i.onInputSetup,dragOver:i.onDragOver,upload:i.onUpload}),n.setClass(e,i.opt.zoneClass),i.hook(e)},n.FileDrop=function(e,t){function i(t){return function(){n.setClass(e,a.opt.dragOverClass,t)}}var a=this;e=n.byID(e),a.handle=new n.DropHandle(e,t),a.handle.filedrop=a,n.extend(a.handle.opt,{dragOverClass:"over"}),n.extend(a.handle.opt.iframe,{force:!1}),n.extend(a.handle.events,{send:[],fileSetup:[]}),a.onUpload=function(e){var t=!a.opt.iframe.force&&a.eventFiles(e,!0);t?t.length>0&&n.callAllOfObject(a,"send",[t]):!a.handle.sendViaIFrame()&&n.hasConsole&&console.warn("FileDrop fallback upload triggered but iframe options were not configured - doing nothing.")},a.eventFiles=function(e,t){var i=new n.FileList(e);if(e.dataTransfer&&(e.dataTransfer.length||e.dataTransfer.files))var r=e.dataTransfer;else var r=e.target&&e.target.files||e.srcElement&&e.srcElement.files;if(r){var o=r.items||[];r.files&&(r=r.files);for(var s={},l=0;l<r.length;l++){var u=new n.File(r[l]);s[u.name]&&"image.jpg"!=u.name||(s[u.name]=!0,u.setNativeEntry(o[l]),n.callAllOfObject(a,"fileSetup",u),(u.size>0||u.nativeEntry)&&i.push(u))}}else t&&(i=!1);return i},n.extend(a,a.handle),a.event({upload:a.onUpload,send:a.resetForm,dragEnter:i(!0),dragLeave:i(!1),uploadElsewhere:i(!1)}),a.preview({upload:i(!1)})},n.FileList=function(e){var t=this;t.dropEffect=e&&e.dropEffect||"",t.length=0,e=null,t.push=function(e){return t[t.length++]=e,t},t.pop=function(){if(t.length>0){var e=t.last();return delete t[--t.length],e}},t.first=function(){return t[0]},t.last=function(){return t[t.length-1]},t.remove=function(e){for(;e<t.length-1;e++)t[e]=t[e+1];return se.f.pop(),t},t.clear=function(){for(var e=0;e<t.length;e++)delete t[e];return t.length=0,t},t.reverse=function(){for(var e=0;e<Math.floor(t.length/2);e++)t[e]=t[t.length-e-1];return t},t.concat=function(e){for(var i=new n.FileList,a=0;a<t.length;a++)i[a]=t[a];for(var a=0;e&&a<e.length;a++)i[t.length+a+1]=e[a];return i.length=t.length+(e||[]).length,t},t.sort=function(e,n){for(var i=0;i<t.length;i++)for(var a=0;a<t.length;a++)if(e.call(n||this,t[i],t[a],i,a)<0){var r=t[i];t[i]=t[a],t[a]=r}return t},t.sortBy=function(e,n){for(var i=[],a=0;a<t.length;a++)i.push([a,e.call(n||this,t[a],a)]);i.sort(function(e,t){return e[1]>t[1]?1:e[1]<t[1]?-1:0});for(var a=0;a<i.length;a++)t[a]=i[a][0];return t},t.find=function(e,n){for(var i=0;i<t.length;i++){var a=e.call(n||this,t[i],i);if(null!=a)return t[i]}},t.each=function(e,n){return t.find(function(){e.apply(this,arguments)},n),t},t.invoke=function(e,t){var i=n.toArray(arguments,1);return this.each(function(t){t[e].apply(t,i)})},t.abort=function(){return this.invoke("abort")},t.findCompare=function(e,n){var i,a,r=null;return t.each(function(t){(null==r||r<(a=e.call(n,i)))&&(i=t)},n),i},t.filter=function(e,i){var a=new n.FileList;return t.each(function(t){e.apply(this,arguments)&&a.push(t)},i),a},t.largest=function(){return t.findCompare(function(e){return e.size})},t.smallest=function(){return t.findCompare(function(e){return-e.size})},t.oldest=function(){return t.findCompare(function(e){return-e.modDate.getTime()})},t.newest=function(){return t.findCompare(function(e){return e.modDate})},t.ofType=function(e){return e+=-1==e.indexOf("/")?"/":"$",e=new RegExp("^"+e,"i"),t.filter(function(t){return e.test(t.type)})},t.images=function(){return t.ofType("image")},t.named=function(e){return"string"==typeof e?t.find(function(t){return t.name==e}):t.filter(function(t){return e.test(t.name)})}},n.FileList.prototype.length=0,n.FileList.prototype.splice=Array.prototype.splice,n.File=function(t){var i=this;i.nativeFile=t,i.nativeEntry=null,i.name=t.fileName||t.name||"",i.size=t.fileSize||t.size||0,i.type=i.mime=t.fileType||t.type||"",i.modDate=t.lastModifiedDate||new Date,i.xhr=null,i.opt={extraHeaders:!0,xRequestedWith:!0,method:"POST"},i.events={any:[],xhrSetup:[],xhrSend:[],progress:[],done:[],error:[]},i.events.sendXHR=i.events.xhrSend,i.abort=function(){return i.xhr&&i.xhr.abort&&i.xhr.abort(),i},i.sendTo=function(e,t){if(t=n.extend(t,i.opt),t.url=e,i.size)if(window.FileReader){var a=new FileReader;a.onload=function(e){i.sendDataReadyTo(t,e)},a.onerror=function(e){n.callAllOfObject(i,"error",[e])},a.readAsArrayBuffer(i.nativeFile)}else i.sendDataReadyTo(t);else n.hasConsole&&console.warn("Trying to send an empty FileDrop.File.");return i},i.sendDataReadyTo=function(e,t){if(i.abort(),i.xhr=n.newXHR(),i.hookXHR(i.xhr),i.xhr.open(e.method,e.url,!0),i.xhr.overrideMimeType&&i.xhr.overrideMimeType("application/octet-stream"),i.xhr.setRequestHeader("Content-Type","application/octet-stream"),e.extraHeaders){i.xhr.setRequestHeader("X-File-Name",encodeURIComponent(i.name)),i.xhr.setRequestHeader("X-File-Size",i.size),i.xhr.setRequestHeader("X-File-Type",i.type),i.xhr.setRequestHeader("X-File-Date",i.modDate.toGMTString());var a=e.xRequestedWith;if(a===!0){var r=window.FileReader?"FileAPI":"Webkit";a="FileDrop-XHR-"+r}a&&i.xhr.setRequestHeader("X-Requested-With",a)}n.callAllOfObject(i,"xhrSetup",[i.xhr,e]);var o=t&&t.target&&t.target.result?t.target.result:i.nativeFile;return n.callAllOfObject(i,"xhrSend",[i.xhr,o,e]),i.xhr},i.hookXHR=function(e){var t=e.upload||e;e.onreadystatechange=function(t){if(4==e.readyState){try{var a=200==e.status?"done":"error"}catch(t){var a="error"}var r="error"==a?[t,e]:[e,t];n.callAllOfObject(i,a,r)}},t.onprogress=function(t){var a=t.lengthComputable?t.loaded:null;n.callAllOfObject(i,"progress",[a,t.total||null,e,t])}},i.readData=function(e,t,n){return i.read({onDone:e,onError:t,func:n})},i.readDataURL=function(e,t){return i.readData(e,t||!1,"uri")},i.readDataURI=i.readDataURL,i.read=function(t){function a(e,n){"object"==typeof n||(n.message=n),n.fdError=e,t.onError!==!1&&(t.onError||t.onDone).apply(this,arguments)}if(n.extend(t,{onDone:new Function,onError:null,blob:i.nativeFile,func:"",start:0,end:null,mime:""}),!window.FileReader)return a("support",e);(t.start>0||null!=t.end&&t.end)&&(t.blob.slice?(null==t.end&&(t.end=t.blob.size||t.blob.fileSize),t.blob=t.blob.slice(t.start,t.end,t.mime)):n.hasConsole&&console.warn("File Blob/slice() are unsupported - operating on entire File."));var r=new FileReader;r.onerror=function(e){a("read",e)},r.onload=function(e){e.target&&e.target.result?("readAsBinaryString"==t.func&&(e.target.result=String.fromCharCode.apply(null,new Uint8Array(e.target.result))),t.onDone(e.target.result)):r.onerror(e)};var o=t.func;if(n.isArray(o)){var s=o[0];return o[0]=t.blob,r[s].apply(r,o)}if(o&&"bin"!=o){if("url"==o||"uri"==o||"src"==o)o="readAsDataURL";else if("array"==o)o="readAsArrayBuffer";else if("text"==o)o="readAsText";else if("read"!=o.substr(0,4))return r.readAsText(t.blob,o)}else o="readAsBinaryString";return"readAsBinaryString"==o&&(o="readAsArrayBuffer"),r[o](t.blob)},i.listEntries=function(e,t){function a(t){s-=t,0==s&&e&&(e(o),e=null)}if(i.nativeEntry&&i.nativeEntry.isDirectory){t=t||new Function;var r=i.nativeEntry.createReader(),o=new n.FileList,s=0;return r.readEntries(function(e){for(var i=0;i<e.length;i++){var l=e[i];l.file?(s++,l.file(function(e){var t=new n.File(e);t.setNativeEntry(l),o.push(t),a(1)},function(){o.push(n.File.fromEntry(l)),a(1),t.apply(this,arguments)})):o.push(n.File.fromEntry(l))}i?r.readEntries(arguments.callee,t):a(0)},t),!0}},i.setNativeEntry=function(e){i.nativeEntry=e&&e.webkitGetAsEntry&&e.webkitGetAsEntry()},i.event=function(e,t){return n.appendEventsToObject.apply(i,arguments)},i.preview=function(e,t){return n.previewToObject.apply(i,arguments)},i.onXhrSend=function(e,t){e.send(t)},i.event({xhrSend:i.onXhrSend})},n.File.fromEntry=function(e){var t=new n.File(e);return t.setNativeEntry(e),t.nativeFile=null,t},n.jQuery=function(e){if(e=e||jQuery||window.jQuery,!e)throw"No window.jQuery object to integrate FileDrop into.";e.fn.filedrop=function(t){function i(e,t){return function(i){var r=(t||[]).concat(n.toArray(arguments,1));return a.triggerHandler((e+i).toLowerCase(),r)}}var a=this,r=this.data("filedrop");if("string"==typeof t)if(r){if("undefined"!=typeof r[t]){var o=r[t];return"function"==typeof o?o.apply(r,n.toArray(arguments,1)):o}e.error("There's no method or property FileDrop."+t+".")}else e.error("$.filedrop('comment') needs an initialized FilrDrop on this element.");else if(t&&"object"!=typeof t)e.error("Invalid $.filedrop() parameter - expected nothing (creates new zone), a string (property to access) or an object (custom zone options).");else if(r){if(!t)return r;n.extend(r.opt,t,!0)}else{var s=new FileDrop(this[0],t);s.$el=e(this),this.first().data("filedrop",s),s.event("any",i("fd")),s.on.fileSetup.push(function(e){e.event("any",i("file",[e]))})}return a}},t.FileDrop=n.FileDrop});