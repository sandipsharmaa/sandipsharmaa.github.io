!function(e,t){"function"==typeof define&&define.amd?define("sifter",t):"object"==typeof exports?module.exports=t():e.Sifter=t()}(this,function(){var e=function(e,t){this.items=e,this.settings=t||{diacritics:!0}};e.prototype.tokenize=function(e){if(e=i(String(e||"").toLowerCase()),!e||!e.length)return[];var t,n,s,r,l=[],p=e.split(/ +/);for(t=0,n=p.length;n>t;t++){if(s=a(p[t]),this.settings.diacritics)for(r in o)o.hasOwnProperty(r)&&(s=s.replace(new RegExp(r,"g"),o[r]));l.push({string:p[t],regex:new RegExp(s,"i")})}return l},e.prototype.iterator=function(e,t){var n;n=s(e)?Array.prototype.forEach||function(e){for(var t=0,n=this.length;n>t;t++)e(this[t],t,this)}:function(e){for(var t in this)this.hasOwnProperty(t)&&e(this[t],t,this)},n.apply(e,[t])},e.prototype.getScoreFunction=function(e,t){var n,i,a,s;n=this,e=n.prepareSearch(e,t),a=e.tokens,i=e.options.fields,s=a.length;var o=function(e,t){var n,i;return e?(e=String(e||""),i=e.search(t.regex),-1===i?0:(n=t.string.length/e.length,0===i&&(n+=.5),n)):0},r=function(){var e=i.length;return e?1===e?function(e,t){return o(t[i[0]],e)}:function(t,n){for(var a=0,s=0;e>a;a++)s+=o(n[i[a]],t);return s/e}:function(){return 0}}();return s?1===s?function(e){return r(a[0],e)}:"and"===e.options.conjunction?function(e){for(var t,n=0,i=0;s>n;n++){if(t=r(a[n],e),0>=t)return 0;i+=t}return i/s}:function(e){for(var t=0,n=0;s>t;t++)n+=r(a[t],e);return n/s}:function(){return 0}},e.prototype.getSortFunction=function(e,n){var i,a,s,o,r,l,p,u,c,d,m;if(s=this,e=s.prepareSearch(e,n),m=!e.query&&n.sort_empty||n.sort,c=function(e,t){return"$score"===e?t.score:s.items[t.id][e]},r=[],m)for(i=0,a=m.length;a>i;i++)(e.query||"$score"!==m[i].field)&&r.push(m[i]);if(e.query){for(d=!0,i=0,a=r.length;a>i;i++)if("$score"===r[i].field){d=!1;break}d&&r.unshift({field:"$score",direction:"desc"})}else for(i=0,a=r.length;a>i;i++)if("$score"===r[i].field){r.splice(i,1);break}for(u=[],i=0,a=r.length;a>i;i++)u.push("desc"===r[i].direction?-1:1);return l=r.length,l?1===l?(o=r[0].field,p=u[0],function(e,n){return p*t(c(o,e),c(o,n))}):function(e,n){var i,a,s;for(i=0;l>i;i++)if(s=r[i].field,a=u[i]*t(c(s,e),c(s,n)))return a;return 0}:null},e.prototype.prepareSearch=function(e,t){if("object"==typeof e)return e;t=n({},t);var i=t.fields,a=t.sort,o=t.sort_empty;return i&&!s(i)&&(t.fields=[i]),a&&!s(a)&&(t.sort=[a]),o&&!s(o)&&(t.sort_empty=[o]),{options:t,query:String(e||"").toLowerCase(),tokens:this.tokenize(e),total:0,items:[]}},e.prototype.search=function(e,t){var n,i,a,s,o=this;return i=this.prepareSearch(e,t),t=i.options,e=i.query,s=t.score||o.getScoreFunction(i),e.length?o.iterator(o.items,function(e,a){n=s(e),(t.filter===!1||n>0)&&i.items.push({score:n,id:a})}):o.iterator(o.items,function(e,t){i.items.push({score:1,id:t})}),a=o.getSortFunction(i,t),a&&i.items.sort(a),i.total=i.items.length,"number"==typeof t.limit&&(i.items=i.items.slice(0,t.limit)),i};var t=function(e,t){return"number"==typeof e&&"number"==typeof t?e>t?1:t>e?-1:0:(e=r(String(e||"")),t=r(String(t||"")),e>t?1:t>e?-1:0)},n=function(e,t){var n,i,a,s;for(n=1,i=arguments.length;i>n;n++)if(s=arguments[n])for(a in s)s.hasOwnProperty(a)&&(e[a]=s[a]);return e},i=function(e){return(e+"").replace(/^\s+|\s+$|/g,"")},a=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},s=Array.isArray||$&&$.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o={a:"[aÃ€ÃÃ‚ÃƒÃ„Ã…Ã Ã¡Ã¢Ã£Ã¤Ã¥Ä€ÄÄ…Ä„]",c:"[cÃ‡Ã§Ä‡Ä†ÄÄŒ]",d:"[dÄ‘ÄÄÄŽ]",e:"[eÃˆÃ‰ÃŠÃ‹Ã¨Ã©ÃªÃ«Ä›ÄšÄ’Ä“Ä™Ä˜]",i:"[iÃŒÃÃŽÃÃ¬Ã­Ã®Ã¯ÄªÄ«]",l:"[lÅ‚Å]",n:"[nÃ‘Ã±ÅˆÅ‡Å„Åƒ]",o:"[oÃ’Ã“Ã”Ã•Ã•Ã–Ã˜Ã²Ã³Ã´ÃµÃ¶Ã¸ÅŒÅ]",r:"[rÅ™Å˜]",s:"[sÅ Å¡Å›Åš]",t:"[tÅ¥Å¤]",u:"[uÃ™ÃšÃ›ÃœÃ¹ÃºÃ»Ã¼Å¯Å®ÅªÅ«]",y:"[yÅ¸Ã¿Ã½Ã]",z:"[zÅ½Å¾Å¼Å»ÅºÅ¹]"},r=function(){var e,t,n,i,a="",s={};for(n in o)if(o.hasOwnProperty(n))for(i=o[n].substring(2,o[n].length-1),a+=i,e=0,t=i.length;t>e;e++)s[i.charAt(e)]=n;var r=new RegExp("["+a+"]","g");return function(e){return e.replace(r,function(e){return s[e]}).toLowerCase()}}();return e}),function(e,t){"function"==typeof define&&define.amd?define("microplugin",t):"object"==typeof exports?module.exports=t():e.MicroPlugin=t()}(this,function(){var e={};e.mixin=function(e){e.plugins={},e.prototype.initializePlugins=function(e){var n,i,a,s=this,o=[];if(s.plugins={names:[],settings:{},requested:{},loaded:{}},t.isArray(e))for(n=0,i=e.length;i>n;n++)"string"==typeof e[n]?o.push(e[n]):(s.plugins.settings[e[n].name]=e[n].options,o.push(e[n].name));else if(e)for(a in e)e.hasOwnProperty(a)&&(s.plugins.settings[a]=e[a],o.push(a));for(;o.length;)s.require(o.shift())},e.prototype.loadPlugin=function(t){var n=this,i=n.plugins,a=e.plugins[t];if(!e.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');i.requested[t]=!0,i.loaded[t]=a.fn.apply(n,[n.plugins.settings[t]||{}]),i.names.push(t)},e.prototype.require=function(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]},e.define=function(t,n){e.plugins[t]={name:t,fn:n}}};var t={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}};return e}),function(e,t){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("sifter"),require("microplugin")):e.Selectize=t(e.jQuery,e.Sifter,e.MicroPlugin)}(this,function(e,t,n){"use strict";var i=function(e,t){if("string"!=typeof t||t.length){var n="string"==typeof t?new RegExp(t,"i"):t,i=function(e){var t=0;if(3===e.nodeType){var a=e.data.search(n);if(a>=0&&e.data.length>0){var s=e.data.match(n),o=document.createElement("span");o.className="highlight";var r=e.splitText(a),l=(r.splitText(s[0].length),r.cloneNode(!0));o.appendChild(l),r.parentNode.replaceChild(o,r),t=1}}else if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName))for(var p=0;p<e.childNodes.length;++p)p+=i(e.childNodes[p]);return t};return e.each(function(){i(this)})}},a=function(){};a.prototype={on:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},off:function(e,t){var n=arguments.length;return 0===n?delete this._events:1===n?delete this._events[e]:(this._events=this._events||{},void(e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(t),1)))},trigger:function(e){if(this._events=this._events||{},e in this._events!=!1)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},a.mixin=function(e){for(var t=["on","off","trigger"],n=0;n<t.length;n++)e.prototype[t[n]]=a.prototype[t[n]]};var s=/Mac/.test(navigator.userAgent),o=65,r=13,l=27,p=37,u=38,c=80,d=39,m=40,g=78,f=8,h=46,v=16,w=s?91:17,E=s?18:17,b=9,_=1,y=2,z=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity,$=function(e){return"undefined"!=typeof e},k=function(e){return"undefined"==typeof e||null===e?null:"boolean"==typeof e?e?"1":"0":e+""},x=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},I=function(e){return(e+"").replace(/\$/g,"$$$$")},O={};O.before=function(e,t,n){var i=e[t];e[t]=function(){return n.apply(e,arguments),i.apply(e,arguments)}},O.after=function(e,t,n){var i=e[t];e[t]=function(){var t=i.apply(e,arguments);return n.apply(e,arguments),t}};var R=function(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}},F=function(e,t){var n;return function(){var i=this,a=arguments;window.clearTimeout(n),n=window.setTimeout(function(){e.apply(i,a)},t)}},D=function(e,t,n){var i,a=e.trigger,s={};e.trigger=function(){var n=arguments[0];return-1===t.indexOf(n)?a.apply(e,arguments):void(s[n]=arguments)},n.apply(e,[]),e.trigger=a;for(i in s)s.hasOwnProperty(i)&&a.apply(e,s[i])},C=function(e,t,n,i){e.on(t,n,function(t){for(var n=t.target;n&&n.parentNode!==e[0];)n=n.parentNode;return t.currentTarget=n,i.apply(this,[t])})},A=function(e){var t={};if("selectionStart"in e)t.start=e.selectionStart,t.length=e.selectionEnd-t.start;else if(document.selection){e.focus();var n=document.selection.createRange(),i=document.selection.createRange().text.length;n.moveStart("character",-e.value.length),t.start=n.text.length-i,t.length=i}return t},T=function(e,t,n){var i,a,s={};if(n)for(i=0,a=n.length;a>i;i++)s[n[i]]=e.css(n[i]);else s=e.css();t.css(s)},j=function(t,n){if(!t)return 0;var i=e("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(t).appendTo("body");T(n,i,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var a=i.width();return i.remove(),a},L=function(e){var t=null,n=function(n,i){var a,s,o,r,l,p,u,c;n=n||window.event||{},i=i||{},n.metaKey||n.altKey||(i.force||e.data("grow")!==!1)&&(a=e.val(),n.type&&"keydown"===n.type.toLowerCase()&&(s=n.keyCode,o=s>=97&&122>=s||s>=65&&90>=s||s>=48&&57>=s||32===s,s===h||s===f?(c=A(e[0]),c.length?a=a.substring(0,c.start)+a.substring(c.start+c.length):s===f&&c.start?a=a.substring(0,c.start-1)+a.substring(c.start+1):s===h&&"undefined"!=typeof c.start&&(a=a.substring(0,c.start)+a.substring(c.start+1))):o&&(p=n.shiftKey,u=String.fromCharCode(n.keyCode),u=p?u.toUpperCase():u.toLowerCase(),a+=u)),r=e.attr("placeholder"),!a&&r&&(a=r),l=j(a,e)+4,l!==t&&(t=l,e.width(l),e.triggerHandler("resize")))};e.on("keydown keyup update blur",n),n()},M=function(n,i){var a,s,o,r,l=this;r=n[0],r.selectize=l;var p=window.getComputedStyle&&window.getComputedStyle(r,null);if(o=p?p.getPropertyValue("direction"):r.currentStyle&&r.currentStyle.direction,o=o||n.parents("[dir]:first").attr("dir")||"",e.extend(l,{order:0,settings:i,$input:n,tabIndex:n.attr("tabindex")||"",tagType:"select"===r.tagName.toLowerCase()?_:y,rtl:/rtl/i.test(o),eventNS:".selectize"+ ++M.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:n.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===i.loadThrottle?l.onSearchChange:F(l.onSearchChange,i.loadThrottle)}),l.sifter=new t(this.options,{diacritics:i.diacritics}),l.settings.options){for(a=0,s=l.settings.options.length;s>a;a++)l.registerOption(l.settings.options[a]);delete l.settings.options}if(l.settings.optgroups){for(a=0,s=l.settings.optgroups.length;s>a;a++)l.registerOptionGroup(l.settings.optgroups[a]);delete l.settings.optgroups}l.settings.mode=l.settings.mode||(1===l.settings.maxItems?"single":"multi"),"boolean"!=typeof l.settings.hideSelected&&(l.settings.hideSelected="multi"===l.settings.mode),l.initializePlugins(l.settings.plugins),l.setupCallbacks(),l.setupTemplates(),l.setup()};return a.mixin(M),n.mixin(M),e.extend(M.prototype,{setup:function(){var t,n,i,a,o,r,l,p,u,c=this,d=c.settings,m=c.eventNS,g=e(window),f=e(document),h=c.$input;if(l=c.settings.mode,p=h.attr("class")||"",t=e("<div>").addClass(d.wrapperClass).addClass(p).addClass(l),n=e("<div>").addClass(d.inputClass).addClass("items").appendTo(t),i=e('<input type="text" autocomplete="off" />').appendTo(n).attr("tabindex",h.is(":disabled")?"-1":c.tabIndex),r=e(d.dropdownParent||t),a=e("<div>").addClass(d.dropdownClass).addClass(l).hide().appendTo(r),o=e("<div>").addClass(d.dropdownContentClass).appendTo(a),c.settings.copyClassesToDropdown&&a.addClass(p),t.css({width:h[0].style.width}),c.plugins.names.length&&(u="plugin-"+c.plugins.names.join(" plugin-"),t.addClass(u),a.addClass(u)),(null===d.maxItems||d.maxItems>1)&&c.tagType===_&&h.attr("multiple","multiple"),c.settings.placeholder&&i.attr("placeholder",d.placeholder),!c.settings.splitOn&&c.settings.delimiter){var b=c.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");c.settings.splitOn=new RegExp("\\s*"+b+"+\\s*")}h.attr("autocorrect")&&i.attr("autocorrect",h.attr("autocorrect")),h.attr("autocapitalize")&&i.attr("autocapitalize",h.attr("autocapitalize")),c.$wrapper=t,c.$control=n,c.$control_input=i,c.$dropdown=a,c.$dropdown_content=o,a.on("mouseenter","[data-selectable]",function(){return c.onOptionHover.apply(c,arguments)}),a.on("mousedown click","[data-selectable]",function(){return c.onOptionSelect.apply(c,arguments)}),C(n,"mousedown","*:not(input)",function(){return c.onItemSelect.apply(c,arguments)}),L(i),n.on({mousedown:function(){return c.onMouseDown.apply(c,arguments)},click:function(){return c.onClick.apply(c,arguments)}}),i.on({mousedown:function(e){e.stopPropagation()},keydown:function(){return c.onKeyDown.apply(c,arguments)},keyup:function(){return c.onKeyUp.apply(c,arguments)},keypress:function(){return c.onKeyPress.apply(c,arguments)},resize:function(){c.positionDropdown.apply(c,[])},blur:function(){return c.onBlur.apply(c,arguments)},focus:function(){return c.ignoreBlur=!1,c.onFocus.apply(c,arguments)},paste:function(){return c.onPaste.apply(c,arguments)}}),f.on("keydown"+m,function(e){c.isCmdDown=e[s?"metaKey":"ctrlKey"],c.isCtrlDown=e[s?"altKey":"ctrlKey"],c.isShiftDown=e.shiftKey}),f.on("keyup"+m,function(e){e.keyCode===E&&(c.isCtrlDown=!1),e.keyCode===v&&(c.isShiftDown=!1),e.keyCode===w&&(c.isCmdDown=!1)}),f.on("mousedown"+m,function(e){if(c.isFocused){if(e.target===c.$dropdown[0]||e.target.parentNode===c.$dropdown[0])return!1;c.$control.has(e.target).length||e.target===c.$control[0]||c.blur(e.target)}}),g.on(["scroll"+m,"resize"+m].join(" "),function(){c.isOpen&&c.positionDropdown.apply(c,arguments)}),g.on("mousemove"+m,function(){c.ignoreHover=!1}),this.revertSettings={$children:h.children().detach(),tabindex:h.attr("tabindex")},h.attr("tabindex",-1).hide().after(c.$wrapper),e.isArray(d.items)&&(c.setValue(d.items),delete d.items),z&&h.on("invalid"+m,function(e){e.preventDefault(),c.isInvalid=!0,c.refreshState()}),c.updateOriginalInput(),c.refreshItems(),c.refreshState(),c.updatePlaceholder(),c.isSetup=!0,h.is(":disabled")&&c.disable(),c.on("change",this.onChange),h.data("selectize",c),h.addClass("selectized"),c.trigger("initialize"),d.preload===!0&&c.onSearchChange("")},setupTemplates:function(){var t=this,n=t.settings.labelField,i=t.settings.optgroupLabelField,a={optgroup:function(e){return'<div class="optgroup">'+e.html+"</div>"},optgroup_header:function(e,t){return'<div class="optgroup-header">'+t(e[i])+"</div>"},option:function(e,t){return'<div class="option">'+t(e[n])+"</div>"},item:function(e,t){return'<div class="item">'+t(e[n])+"</div>"},option_create:function(e,t){return'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>"}};t.settings.render=e.extend({},a,t.settings.render)},setupCallbacks:function(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)n.hasOwnProperty(e)&&(t=this.settings[n[e]],t&&this.on(e,t))},onClick:function(e){var t=this;t.isFocused||(t.focus(),e.preventDefault())},onMouseDown:function(t){var n=this,i=t.isDefaultPrevented();e(t.target);if(n.isFocused){if(t.target!==n.$control_input[0])return"single"===n.settings.mode?n.isOpen?n.close():n.open():i||n.setActiveItem(null),!1}else i||window.setTimeout(function(){n.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var n=this;n.isFull()||n.isInputHidden||n.isLocked?t.preventDefault():n.settings.splitOn&&setTimeout(function(){for(var t=e.trim(n.$control_input.val()||"").split(n.settings.splitOn),i=0,a=t.length;a>i;i++)n.createItem(t[i])},0)},onKeyPress:function(e){if(this.isLocked)return e&&e.preventDefault();var t=String.fromCharCode(e.keyCode||e.which);return this.settings.create&&"multi"===this.settings.mode&&t===this.settings.delimiter?(this.createItem(),e.preventDefault(),!1):void 0},onKeyDown:function(e){var t=(e.target===this.$control_input[0],this);if(t.isLocked)return void(e.keyCode!==b&&e.preventDefault());switch(e.keyCode){case o:if(t.isCmdDown)return void t.selectAll();break;case l:return void(t.isOpen&&(e.preventDefault(),e.stopPropagation(),t.close()));case g:if(!e.ctrlKey||e.altKey)break;case m:if(!t.isOpen&&t.hasOptions)t.open();else if(t.$activeOption){t.ignoreHover=!0;var n=t.getAdjacentOption(t.$activeOption,1);n.length&&t.setActiveOption(n,!0,!0)}return void e.preventDefault();case c:if(!e.ctrlKey||e.altKey)break;case u:if(t.$activeOption){t.ignoreHover=!0;var i=t.getAdjacentOption(t.$activeOption,-1);i.length&&t.setActiveOption(i,!0,!0)}return void e.preventDefault();case r:return void(t.isOpen&&t.$activeOption&&(t.onOptionSelect({currentTarget:t.$activeOption}),e.preventDefault()));case p:return void t.advanceSelection(-1,e);case d:return void t.advanceSelection(1,e);case b:return t.settings.selectOnTab&&t.isOpen&&t.$activeOption&&(t.onOptionSelect({currentTarget:t.$activeOption}),t.isFull()||e.preventDefault()),void(t.settings.create&&t.createItem()&&e.preventDefault());case f:case h:return void t.deleteSelection(e)}return!t.isFull()&&!t.isInputHidden||(s?e.metaKey:e.ctrlKey)?void 0:void e.preventDefault()},onKeyUp:function(e){var t=this;if(t.isLocked)return e&&e.preventDefault();var n=t.$control_input.val()||"";t.lastValue!==n&&(t.lastValue=n,t.onSearchChange(n),t.refreshOptions(),t.trigger("type",n))},onSearchChange:function(e){var t=this,n=t.settings.load;n&&(t.loadedSearches.hasOwnProperty(e)||(t.loadedSearches[e]=!0,t.load(function(i){n.apply(t,[e,i])})))},onFocus:function(e){var t=this,n=t.isFocused;return t.isDisabled?(t.blur(),e&&e.preventDefault(),!1):void(t.ignoreFocus||(t.isFocused=!0,"focus"===t.settings.preload&&t.onSearchChange(""),n||t.trigger("focus"),t.$activeItems.length||(t.showInput(),t.setActiveItem(null),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState()))},onBlur:function(e,t){var n=this;if(n.isFocused&&(n.isFocused=!1,!n.ignoreFocus)){if(!n.ignoreBlur&&document.activeElement===n.$dropdown_content[0])return n.ignoreBlur=!0,void n.onFocus(e);var i=function(){n.close(),n.setTextboxValue(""),n.setActiveItem(null),n.setActiveOption(null),n.setCaret(n.items.length),n.refreshState(),(t||document.body).focus(),n.ignoreFocus=!1,n.trigger("blur")};n.ignoreFocus=!0,n.settings.create&&n.settings.createOnBlur?n.createItem(null,!1,i):i()}},onOptionHover:function(e){this.ignoreHover||this.setActiveOption(e.currentTarget,!1)},onOptionSelect:function(t){var n,i,a=this;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),i=e(t.currentTarget),i.hasClass("create")?a.createItem(null,function(){a.settings.closeAfterSelect&&a.close()}):(n=i.attr("data-value"),"undefined"!=typeof n&&(a.lastQuery=null,a.setTextboxValue(""),a.addItem(n),a.settings.closeAfterSelect?a.close():!a.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&a.setActiveOption(a.getOption(n))))},onItemSelect:function(e){var t=this;t.isLocked||"multi"===t.settings.mode&&(e.preventDefault(),t.setActiveItem(e.currentTarget,e))},load:function(e){var t=this,n=t.$wrapper.addClass(t.settings.loadingClass);t.loading++,e.apply(t,[function(e){t.loading=Math.max(t.loading-1,0),e&&e.length&&(t.addOption(e),t.refreshOptions(t.isFocused&&!t.isInputHidden)),t.loading||n.removeClass(t.settings.loadingClass),t.trigger("load",e)}])},setTextboxValue:function(e){var t=this.$control_input,n=t.val()!==e;n&&(t.val(e).triggerHandler("update"),this.lastValue=e)},getValue:function(){return this.tagType===_&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(e,t){var n=t?[]:["change"];D(this,n,function(){this.clear(t),this.addItems(e,t)})},setActiveItem:function(t,n){var i,a,s,o,r,l,p,u,c=this;if("single"!==c.settings.mode){if(t=e(t),!t.length)return e(c.$activeItems).removeClass("active"),c.$activeItems=[],void(c.isFocused&&c.showInput());if(i=n&&n.type.toLowerCase(),"mousedown"===i&&c.isShiftDown&&c.$activeItems.length){for(u=c.$control.children(".active:last"),o=Array.prototype.indexOf.apply(c.$control[0].childNodes,[u[0]]),r=Array.prototype.indexOf.apply(c.$control[0].childNodes,[t[0]]),o>r&&(p=o,o=r,r=p),a=o;r>=a;a++)l=c.$control[0].childNodes[a],-1===c.$activeItems.indexOf(l)&&(e(l).addClass("active"),c.$activeItems.push(l));n.preventDefault()}else"mousedown"===i&&c.isCtrlDown||"keydown"===i&&this.isShiftDown?t.hasClass("active")?(s=c.$activeItems.indexOf(t[0]),c.$activeItems.splice(s,1),t.removeClass("active")):c.$activeItems.push(t.addClass("active")[0]):(e(c.$activeItems).removeClass("active"),c.$activeItems=[t.addClass("active")[0]]);c.hideInput(),this.isFocused||c.focus()}},setActiveOption:function(t,n,i){var a,s,o,r,l,p=this;p.$activeOption&&p.$activeOption.removeClass("active"),p.$activeOption=null,t=e(t),t.length&&(p.$activeOption=t.addClass("active"),(n||!$(n))&&(a=p.$dropdown_content.height(),s=p.$activeOption.outerHeight(!0),n=p.$dropdown_content.scrollTop()||0,o=p.$activeOption.offset().top-p.$dropdown_content.offset().top+n,r=o,l=o-a+s,o+s>a+n?p.$dropdown_content.stop().animate({scrollTop:l},i?p.settings.scrollDuration:0):n>o&&p.$dropdown_content.stop().animate({scrollTop:r},i?p.settings.scrollDuration:0)))},selectAll:function(){var e=this;"single"!==e.settings.mode&&(e.$activeItems=Array.prototype.slice.apply(e.$control.children(":not(input)").addClass("active")),e.$activeItems.length&&(e.hideInput(),e.close()),e.focus())},hideInput:function(){var e=this;e.setTextboxValue(""),e.$control_input.css({opacity:0,position:"absolute",left:e.rtl?1e4:-1e4}),e.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.$control_input[0].focus(),window.setTimeout(function(){e.ignoreFocus=!1,e.onFocus()},0))},blur:function(e){this.$control_input[0].blur(),this.onBlur(null,e)},getScoreFunction:function(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())},getSearchOptions:function(){var e=this.settings,t=e.sortField;return"string"==typeof t&&(t=[{field:t}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t}},search:function(t){var n,i,a,s=this,o=s.settings,r=this.getSearchOptions();if(o.score&&(a=s.settings.score.apply(this,[t]),"function"!=typeof a))throw new Error('Selectize "score" setting must be a function that returns a function');if(t!==s.lastQuery?(s.lastQuery=t,i=s.sifter.search(t,e.extend(r,{score:a})),s.currentResults=i):i=e.extend(!0,{},s.currentResults),o.hideSelected)for(n=i.items.length-1;n>=0;n--)-1!==s.items.indexOf(k(i.items[n].id))&&i.items.splice(n,1);return i},refreshOptions:function(t){var n,a,s,o,r,l,p,u,c,d,m,g,f,h,v,w;"undefined"==typeof t&&(t=!0);var E=this,b=e.trim(E.$control_input.val()),_=E.search(b),y=E.$dropdown_content,z=E.$activeOption&&k(E.$activeOption.attr("data-value"));for(o=_.items.length,"number"==typeof E.settings.maxOptions&&(o=Math.min(o,E.settings.maxOptions)),r={},l=[],n=0;o>n;n++)for(p=E.options[_.items[n].id],u=E.render("option",p),c=p[E.settings.optgroupField]||"",d=e.isArray(c)?c:[c],a=0,s=d&&d.length;s>a;a++)c=d[a],E.optgroups.hasOwnProperty(c)||(c=""),r.hasOwnProperty(c)||(r[c]=[],l.push(c)),r[c].push(u);for(this.settings.lockOptgroupOrder&&l.sort(function(e,t){var n=E.optgroups[e].$order||0,i=E.optgroups[t].$order||0;return n-i}),m=[],n=0,o=l.length;o>n;n++)c=l[n],E.optgroups.hasOwnProperty(c)&&r[c].length?(g=E.render("optgroup_header",E.optgroups[c])||"",g+=r[c].join(""),m.push(E.render("optgroup",e.extend({},E.optgroups[c],{html:g})))):m.push(r[c].join(""));if(y.html(m.join("")),E.settings.highlight&&_.query.length&&_.tokens.length)for(n=0,o=_.tokens.length;o>n;n++)i(y,_.tokens[n].regex);if(!E.settings.hideSelected)for(n=0,o=E.items.length;o>n;n++)E.getOption(E.items[n]).addClass("selected");f=E.canCreate(b),f&&(y.prepend(E.render("option_create",{input:b})),w=e(y[0].childNodes[0])),E.hasOptions=_.items.length>0||f,E.hasOptions?(_.items.length>0?(v=z&&E.getOption(z),v&&v.length?h=v:"single"===E.settings.mode&&E.items.length&&(h=E.getOption(E.items[0])),h&&h.length||(h=w&&!E.settings.addPrecedence?E.getAdjacentOption(w,1):y.find("[data-selectable]:first"))):h=w,E.setActiveOption(h),t&&!E.isOpen&&E.open()):(E.setActiveOption(null),t&&E.isOpen&&E.close())},addOption:function(t){var n,i,a,s=this;if(e.isArray(t))for(n=0,i=t.length;i>n;n++)s.addOption(t[n]);else(a=s.registerOption(t))&&(s.userOptions[a]=!0,s.lastQuery=null,s.trigger("option_add",a,t))},registerOption:function(e){var t=k(e[this.settings.valueField]);return!t||this.options.hasOwnProperty(t)?!1:(e.$order=e.$order||++this.order,this.options[t]=e,t)},registerOptionGroup:function(e){var t=k(e[this.settings.optgroupValueField]);return t?(e.$order=e.$order||++this.order,this.optgroups[t]=e,t):!1},addOptionGroup:function(e,t){t[this.settings.optgroupValueField]=e,(e=this.registerOptionGroup(t))&&this.trigger("optgroup_add",e,t)},removeOptionGroup:function(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.renderCache={},this.trigger("optgroup_remove",e))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(t,n){var i,a,s,o,r,l,p,u=this;if(t=k(t),s=k(n[u.settings.valueField]),null!==t&&u.options.hasOwnProperty(t)){if("string"!=typeof s)throw new Error("Value must be set in option data");p=u.options[t].$order,s!==t&&(delete u.options[t],o=u.items.indexOf(t),-1!==o&&u.items.splice(o,1,s)),n.$order=n.$order||p,u.options[s]=n,r=u.renderCache.item,l=u.renderCache.option,r&&(delete r[t],delete r[s]),l&&(delete l[t],delete l[s]),-1!==u.items.indexOf(s)&&(i=u.getItem(t),a=e(u.render("item",n)),i.hasClass("active")&&a.addClass("active"),i.replaceWith(a)),u.lastQuery=null,u.isOpen&&u.refreshOptions(!1)}},removeOption:function(e,t){var n=this;e=k(e);var i=n.renderCache.item,a=n.renderCache.option;i&&delete i[e],a&&delete a[e],delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)},clearOptions:function(){var e=this;e.loadedSearches={},e.userOptions={},e.renderCache={},e.options=e.sifter.items={},e.lastQuery=null,e.trigger("option_clear"),e.clear()},getOption:function(e){return this.getElementWithValue(e,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(t,n){var i=this.$dropdown.find("[data-selectable]"),a=i.index(t)+n;return a>=0&&a<i.length?i.eq(a):e()},getElementWithValue:function(t,n){if(t=k(t),"undefined"!=typeof t&&null!==t)for(var i=0,a=n.length;a>i;i++)if(n[i].getAttribute("data-value")===t)return e(n[i]);return e()},getItem:function(e){return this.getElementWithValue(e,this.$control.children())},addItems:function(t,n){for(var i=e.isArray(t)?t:[t],a=0,s=i.length;s>a;a++)this.isPending=s-1>a,this.addItem(i[a],n)},addItem:function(t,n){var i=n?[]:["change"];D(this,i,function(){var i,a,s,o,r,l=this,p=l.settings.mode;return t=k(t),-1!==l.items.indexOf(t)?void("single"===p&&l.close()):void(l.options.hasOwnProperty(t)&&("single"===p&&l.clear(n),"multi"===p&&l.isFull()||(i=e(l.render("item",l.options[t])),r=l.isFull(),l.items.splice(l.caretPos,0,t),l.insertAtCaret(i),(!l.isPending||!r&&l.isFull())&&l.refreshState(),l.isSetup&&(s=l.$dropdown_content.find("[data-selectable]"),l.isPending||(a=l.getOption(t),o=l.getAdjacentOption(a,1).attr("data-value"),l.refreshOptions(l.isFocused&&"single"!==p),o&&l.setActiveOption(l.getOption(o))),!s.length||l.isFull()?l.close():l.positionDropdown(),l.updatePlaceholder(),l.trigger("item_add",t,i),l.updateOriginalInput({silent:n})))))})},removeItem:function(e,t){var n,i,a,s=this;n="object"==typeof e?e:s.getItem(e),e=k(n.attr("data-value")),i=s.items.indexOf(e),-1!==i&&(n.remove(),n.hasClass("active")&&(a=s.$activeItems.indexOf(n[0]),s.$activeItems.splice(a,1)),s.items.splice(i,1),s.lastQuery=null,!s.settings.persist&&s.userOptions.hasOwnProperty(e)&&s.removeOption(e,t),i<s.caretPos&&s.setCaret(s.caretPos-1),s.refreshState(),s.updatePlaceholder(),s.updateOriginalInput({silent:t}),s.positionDropdown(),s.trigger("item_remove",e,n))},createItem:function(t,n){var i=this,a=i.caretPos;t=t||e.trim(i.$control_input.val()||"");var s=arguments[arguments.length-1];if("function"!=typeof s&&(s=function(){}),"boolean"!=typeof n&&(n=!0),!i.canCreate(t))return s(),!1;i.lock();var o="function"==typeof i.settings.create?this.settings.create:function(e){var t={};return t[i.settings.labelField]=e,t[i.settings.valueField]=e,t},r=R(function(e){if(i.unlock(),!e||"object"!=typeof e)return s();var t=k(e[i.settings.valueField]);return"string"!=typeof t?s():(i.setTextboxValue(""),i.addOption(e),i.setCaret(a),i.addItem(t),i.refreshOptions(n&&"single"!==i.settings.mode),void s(e))}),l=o.apply(this,[t,r]);return"undefined"!=typeof l&&r(l),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){var e,t=this;t.isRequired&&(t.items.length&&(t.isInvalid=!1),t.$control_input.prop("required",e)),t.refreshClasses()},refreshClasses:function(){var t=this,n=t.isFull(),i=t.isLocked;t.$wrapper.toggleClass("rtl",t.rtl),t.$control.toggleClass("focus",t.isFocused).toggleClass("disabled",t.isDisabled).toggleClass("required",t.isRequired).toggleClass("invalid",t.isInvalid).toggleClass("locked",i).toggleClass("full",n).toggleClass("not-full",!n).toggleClass("input-active",t.isFocused&&!t.isInputHidden).toggleClass("dropdown-active",t.isOpen).toggleClass("has-options",!e.isEmptyObject(t.options)).toggleClass("has-items",t.items.length>0),t.$control_input.data("grow",!n&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(e){var t,n,i,a,s=this;if(e=e||{},s.tagType===_){for(i=[],t=0,n=s.items.length;n>t;t++)a=s.options[s.items[t]][s.settings.labelField]||"",i.push('<option value="'+x(s.items[t])+'" selected="selected">'+x(a)+"</option>");i.length||this.$input.attr("multiple")||i.push('<option value="" selected="selected"></option>'),s.$input.html(i.join(""))}else s.$input.val(s.getValue()),s.$input.attr("value",s.$input.val());s.isSetup&&(e.silent||s.trigger("change",s.$input.val()))},updatePlaceholder:function(){if(this.settings.placeholder){var e=this.$control_input;this.items.length?e.removeAttr("placeholder"):e.attr("placeholder",this.settings.placeholder),e.triggerHandler("update",{force:!0})}},open:function(){var e=this;e.isLocked||e.isOpen||"multi"===e.settings.mode&&e.isFull()||(e.focus(),e.isOpen=!0,e.refreshState(),e.$dropdown.css({visibility:"hidden",display:"block"}),e.positionDropdown(),e.$dropdown.css({visibility:"visible"}),e.trigger("dropdown_open",e.$dropdown))},close:function(){var e=this,t=e.isOpen;"single"===e.settings.mode&&e.items.length&&e.hideInput(),e.isOpen=!1,e.$dropdown.hide(),e.setActiveOption(null),e.refreshState(),t&&e.trigger("dropdown_close",e.$dropdown)},positionDropdown:function(){var e=this.$control,t="body"===this.settings.dropdownParent?e.offset():e.position();t.top+=e.outerHeight(!0),this.$dropdown.css({width:e.outerWidth(),top:t.top,left:t.left})},clear:function(e){var t=this;t.items.length&&(t.$control.children(":not(input)").remove(),t.items=[],t.lastQuery=null,t.setCaret(0),t.setActiveItem(null),t.updatePlaceholder(),t.updateOriginalInput({silent:e}),t.refreshState(),t.showInput(),t.trigger("clear"))},insertAtCaret:function(t){var n=Math.min(this.caretPos,this.items.length);0===n?this.$control.prepend(t):e(this.$control[0].childNodes[n]).before(t),this.setCaret(n+1)},deleteSelection:function(t){var n,i,a,s,o,r,l,p,u,c=this;if(a=t&&t.keyCode===f?-1:1,s=A(c.$control_input[0]),c.$activeOption&&!c.settings.hideSelected&&(l=c.getAdjacentOption(c.$activeOption,-1).attr("data-value")),
o=[],c.$activeItems.length){for(u=c.$control.children(".active:"+(a>0?"last":"first")),r=c.$control.children(":not(input)").index(u),a>0&&r++,n=0,i=c.$activeItems.length;i>n;n++)o.push(e(c.$activeItems[n]).attr("data-value"));t&&(t.preventDefault(),t.stopPropagation())}else(c.isFocused||"single"===c.settings.mode)&&c.items.length&&(0>a&&0===s.start&&0===s.length?o.push(c.items[c.caretPos-1]):a>0&&s.start===c.$control_input.val().length&&o.push(c.items[c.caretPos]));if(!o.length||"function"==typeof c.settings.onDelete&&c.settings.onDelete.apply(c,[o])===!1)return!1;for("undefined"!=typeof r&&c.setCaret(r);o.length;)c.removeItem(o.pop());return c.showInput(),c.positionDropdown(),c.refreshOptions(!0),l&&(p=c.getOption(l),p.length&&c.setActiveOption(p)),!0},advanceSelection:function(e,t){var n,i,a,s,o,r,l=this;0!==e&&(l.rtl&&(e*=-1),n=e>0?"last":"first",i=A(l.$control_input[0]),l.isFocused&&!l.isInputHidden?(s=l.$control_input.val().length,o=0>e?0===i.start&&0===i.length:i.start===s,o&&!s&&l.advanceCaret(e,t)):(r=l.$control.children(".active:"+n),r.length&&(a=l.$control.children(":not(input)").index(r),l.setActiveItem(null),l.setCaret(e>0?a+1:a))))},advanceCaret:function(e,t){var n,i,a=this;0!==e&&(n=e>0?"next":"prev",a.isShiftDown?(i=a.$control_input[n](),i.length&&(a.hideInput(),a.setActiveItem(i),t&&t.preventDefault())):a.setCaret(a.caretPos+e))},setCaret:function(t){var n=this;if(t="single"===n.settings.mode?n.items.length:Math.max(0,Math.min(n.items.length,t)),!n.isPending){var i,a,s,o;for(s=n.$control.children(":not(input)"),i=0,a=s.length;a>i;i++)o=e(s[i]).detach(),t>i?n.$control_input.before(o):n.$control.append(o)}n.caretPos=t},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var e=this;e.$input.prop("disabled",!0),e.$control_input.prop("disabled",!0).prop("tabindex",-1),e.isDisabled=!0,e.lock()},enable:function(){var e=this;e.$input.prop("disabled",!1),e.$control_input.prop("disabled",!1).prop("tabindex",e.tabIndex),e.isDisabled=!1,e.unlock()},destroy:function(){var t=this,n=t.eventNS,i=t.revertSettings;t.trigger("destroy"),t.off(),t.$wrapper.remove(),t.$dropdown.remove(),t.$input.html("").append(i.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:i.tabindex}).show(),t.$control_input.removeData("grow"),t.$input.removeData("selectize"),e(window).off(n),e(document).off(n),e(document.body).off(n),delete t.$input[0].selectize},render:function(e,t){var n,i,a="",s=!1,o=this,r=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===e||"item"===e)&&(n=k(t[o.settings.valueField]),s=!!n),s&&($(o.renderCache[e])||(o.renderCache[e]={}),o.renderCache[e].hasOwnProperty(n))?o.renderCache[e][n]:(a=o.settings.render[e].apply(this,[t,x]),("option"===e||"option_create"===e)&&(a=a.replace(r,"<$1 data-selectable")),"optgroup"===e&&(i=t[o.settings.optgroupValueField]||"",a=a.replace(r,'<$1 data-group="'+I(x(i))+'"')),("option"===e||"item"===e)&&(a=a.replace(r,'<$1 data-value="'+I(x(n||""))+'"')),s&&(o.renderCache[e][n]=a),a)},clearCache:function(e){var t=this;"undefined"==typeof e?t.renderCache={}:delete t.renderCache[e]},canCreate:function(e){var t=this;if(!t.settings.create)return!1;var n=t.settings.createFilter;return!(!e.length||"function"==typeof n&&!n.apply(t,[e])||"string"==typeof n&&!new RegExp(n).test(e)||n instanceof RegExp&&!n.test(e))}}),M.count=0,M.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},e.fn.selectize=function(t){var n=e.fn.selectize.defaults,i=e.extend({},n,t),a=i.dataAttr,s=i.labelField,o=i.valueField,r=i.optgroupField,l=i.optgroupLabelField,p=i.optgroupValueField,u=function(t,n){var r,l,p,u,c=t.attr(a);if(c)for(n.options=JSON.parse(c),r=0,l=n.options.length;l>r;r++)n.items.push(n.options[r][o]);else{var d=e.trim(t.val()||"");if(!i.allowEmptyOption&&!d.length)return;for(p=d.split(i.delimiter),r=0,l=p.length;l>r;r++)u={},u[s]=p[r],u[o]=p[r],n.options.push(u);n.items=p}},c=function(t,n){var u,c,d,m,g=n.options,f={},h=function(e){var t=a&&e.attr(a);return"string"==typeof t&&t.length?JSON.parse(t):null},v=function(t,a){t=e(t);var l=k(t.attr("value"));if(l||i.allowEmptyOption)if(f.hasOwnProperty(l)){if(a){var p=f[l][r];p?e.isArray(p)?p.push(a):f[l][r]=[p,a]:f[l][r]=a}}else{var u=h(t)||{};u[s]=u[s]||t.text(),u[o]=u[o]||l,u[r]=u[r]||a,f[l]=u,g.push(u),t.is(":selected")&&n.items.push(l)}},w=function(t){var i,a,s,o,r;for(t=e(t),s=t.attr("label"),s&&(o=h(t)||{},o[l]=s,o[p]=s,n.optgroups.push(o)),r=e("option",t),i=0,a=r.length;a>i;i++)v(r[i],s)};for(n.maxItems=t.attr("multiple")?null:1,m=t.children(),u=0,c=m.length;c>u;u++)d=m[u].tagName.toLowerCase(),"optgroup"===d?w(m[u]):"option"===d&&v(m[u])};return this.each(function(){if(!this.selectize){var a,s=e(this),o=this.tagName.toLowerCase(),r=s.attr("placeholder")||s.attr("data-placeholder");r||i.allowEmptyOption||(r=s.children('option[value=""]').text());var l={placeholder:r,options:[],optgroups:[],items:[]};"select"===o?c(s,l):u(s,l),a=new M(s,e.extend(!0,{},n,l,t))}})},e.fn.selectize.defaults=M.defaults,e.fn.selectize.support={validity:z},M.define("drag_drop",function(t){if(!e.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var n=this;n.lock=function(){var e=n.lock;return function(){var t=n.$control.data("sortable");return t&&t.disable(),e.apply(n,arguments)}}(),n.unlock=function(){var e=n.unlock;return function(){var t=n.$control.data("sortable");return t&&t.enable(),e.apply(n,arguments)}}(),n.setup=function(){var t=n.setup;return function(){t.apply(this,arguments);var i=n.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:n.isLocked,start:function(e,t){t.placeholder.css("width",t.helper.css("width")),i.css({overflow:"visible"})},stop:function(){i.css({overflow:"hidden"});var t=n.$activeItems?n.$activeItems.slice():null,a=[];i.children("[data-value]").each(function(){a.push(e(this).attr("data-value"))}),n.setValue(a),n.setActiveItem(t)}})}}()}}),M.define("dropdown_header",function(t){var n=this;t=e.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(e){return'<div class="'+e.headerClass+'"><div class="'+e.titleRowClass+'"><span class="'+e.labelClass+'">'+e.title+'</span><a href="javascript:void(0)" class="'+e.closeClass+'">&times;</a></div></div>'}},t),n.setup=function(){var i=n.setup;return function(){i.apply(n,arguments),n.$dropdown_header=e(t.html(t)),n.$dropdown.prepend(n.$dropdown_header)}}()}),M.define("optgroup_columns",function(t){var n=this;t=e.extend({equalizeWidth:!0,equalizeHeight:!0},t),this.getAdjacentOption=function(t,n){var i=t.closest("[data-group]").find("[data-selectable]"),a=i.index(t)+n;return a>=0&&a<i.length?i.eq(a):e()},this.onKeyDown=function(){var e=n.onKeyDown;return function(t){var i,a,s,o;return!this.isOpen||t.keyCode!==p&&t.keyCode!==d?e.apply(this,arguments):(n.ignoreHover=!0,o=this.$activeOption.closest("[data-group]"),i=o.find("[data-selectable]").index(this.$activeOption),o=t.keyCode===p?o.prev("[data-group]"):o.next("[data-group]"),s=o.find("[data-selectable]"),a=s.eq(Math.min(s.length-1,i)),void(a.length&&this.setActiveOption(a)))}}();var i=function(){var e,t=i.width,n=document;return"undefined"==typeof t&&(e=n.createElement("div"),e.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',e=e.firstChild,n.body.appendChild(e),t=i.width=e.offsetWidth-e.clientWidth,n.body.removeChild(e)),t},a=function(){var a,s,o,r,l,p,u;if(u=e("[data-group]",n.$dropdown_content),s=u.length,s&&n.$dropdown_content.width()){if(t.equalizeHeight){for(o=0,a=0;s>a;a++)o=Math.max(o,u.eq(a).height());u.css({height:o})}t.equalizeWidth&&(p=n.$dropdown_content.innerWidth()-i(),r=Math.round(p/s),u.css({width:r}),s>1&&(l=p-r*(s-1),u.eq(s-1).css({width:l})))}};(t.equalizeHeight||t.equalizeWidth)&&(O.after(this,"positionDropdown",a),O.after(this,"refreshOptions",a))}),M.define("remove_button",function(t){if("single"!==this.settings.mode){t=e.extend({label:"&times;",title:"Remove",className:"remove",append:!0},t);var n=this,i='<a href="javascript:void(0)" class="'+t.className+'" tabindex="-1" title="'+x(t.title)+'">'+t.label+"</a>",a=function(e,t){var n=e.search(/(<\/[^>]+>\s*)$/);return e.substring(0,n)+t+e.substring(n)};this.setup=function(){var s=n.setup;return function(){if(t.append){var o=n.settings.render.item;n.settings.render.item=function(e){return a(o.apply(this,arguments),i)}}s.apply(this,arguments),this.$control.on("click","."+t.className,function(t){if(t.preventDefault(),!n.isLocked){var i=e(t.currentTarget).parent();n.setActiveItem(i),n.deleteSelection()&&n.setCaret(n.items.length)}})}}()}}),M.define("restore_on_backspace",function(e){var t=this;e.text=e.text||function(e){return e[this.settings.labelField]},this.onKeyDown=function(){var n=t.onKeyDown;return function(t){var i,a;return t.keyCode===f&&""===this.$control_input.val()&&!this.$activeItems.length&&(i=this.caretPos-1,i>=0&&i<this.items.length)?(a=this.options[this.items[i]],this.deleteSelection(t)&&(this.setTextboxValue(e.text.apply(this,[a])),this.refreshOptions(!0)),void t.preventDefault()):n.apply(this,arguments)}}()}),M});